"use strict";var X=Object.create;var L=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var Q=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var ee=(e,a)=>()=>(a||e((a={exports:{}}).exports,a),a.exports),te=(e,a)=>{for(var r in a)L(e,r,{get:a[r],enumerable:!0})},R=(e,a,r,i)=>{if(a&&typeof a=="object"||typeof a=="function")for(let n of Q(a))!_.call(e,n)&&n!==r&&L(e,n,{get:()=>a[n],enumerable:!(i=Z(a,n))||i.enumerable});return e};var P=(e,a,r)=>(r=e!=null?X(q(e)):{},R(a||!e||!e.__esModule?L(r,"default",{value:e,enumerable:!0}):r,e)),re=e=>R(L({},"__esModule",{value:!0}),e);var w=ee(d=>{"use strict";var T=d&&d.__assign||function(){return T=Object.assign||function(e){for(var a,r=1,i=arguments.length;r<i;r++){a=arguments[r];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},T.apply(this,arguments)},ae=d&&d.__importStar||function(e){if(e&&e.__esModule)return e;var a={};if(e!=null)for(var r in e)Object.hasOwnProperty.call(e,r)&&(a[r]=e[r]);return a.default=e,a};Object.defineProperty(d,"__esModule",{value:!0});var oe=ae(require("child_process"));function B(e){return Array.isArray(e)&&Object.prototype.hasOwnProperty.call(e,"raw")}function ne(e,a){for(var r="",i=e.length,n=0;n<i;n++){var p=n<i-1?a[n]:"";r+=e[n]+p}return r.trim()}function v(e,a,r){return r===void 0&&(r={}),process.platform!=="darwin"?Promise.reject(new Error("osascript-tag requires macOS")):new Promise(function(i,n){var p=r.argv||[],l=[],g=ne(e,a),K="AppleScript";r.language==="JavaScript"&&(K=r.language,g="(function(...argv){"+g+"})("+p.map(function(c){return JSON.stringify(c)})+")"),r.parse&&(l=["-s","s"]),typeof r.flags=="string"&&(l=["-s",r.flags]);var h=oe.spawn("osascript",["-l",K].concat(l,["-e",g])),x="";h.stderr.on("data",function(c){x+=c.toString()});var k="";h.stdout.on("data",function(c){k+=c.toString()}),h.on("close",function(){if(x)n(x);else{var c=k;if(r.parse)try{c=JSON.parse(k)}catch(b){n(b)}i(c)}}),h.on("error",function(c){n(c)})})}function N(e){for(var a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return B(e)?v(e,a,{}):function(i){for(var n=[],p=1;p<arguments.length;p++)n[p-1]=arguments[p];return v(i,n,e)}}function M(e){for(var a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return B(e)?v(e,a,{language:"JavaScript"}):function(i){for(var n=[],p=1;p<arguments.length;p++)n[p-1]=arguments[p];return v(i,n,T({language:"JavaScript"},e))}}N.jxa=M;d.jxa=M;d.default=N});var ke={};te(ke,{default:()=>xe});module.exports=re(ke);var y=require("@raycast/api"),O=require("react");var E=require("react"),A=require("@raycast/api"),F=P(w()),ie=A.Toast.Style,pe=({appExists:e},a,r)=>{let[i,n]=(0,E.useState)({isLoading:!0,results:[]});return(0,E.useEffect)(()=>{if(!e||a.length===0){n(p=>({...p,isLoading:!1}));return}Promise.resolve().then(()=>n(p=>({...p,isLoading:!0}))).then(()=>se(r,a)).then(p=>n(l=>({...l,results:p}))).catch(I).finally(()=>n(p=>({...p,isLoading:!1})))},[e,a,r]),i},U=pe,se=async(e,a)=>{let r=await(0,F.jxa)({parse:!0})`
      const DT = Application("DEVONthink 3");

      let results;

      if ("${e}" === "") {
          results = DT.search('${a.replaceAll("'","\\'")}');
      } else {
          const database = DT.getRecordWithUuid("${e}");
          results = DT.search('${a.replaceAll("'","\\'")}', {in: database});
      }


      if (results.length === 0) {
          return "[]";
      }

      return JSON.stringify(results.slice(0, 20).map(result => result.properties()));
  `;return JSON.parse(r).sort((n,p)=>p.score-n.score)},I=e=>(console.log(e),(0,A.showToast)(ie.Failure,"Failed to perform the operation",e));var s=require("@raycast/api"),t=require("react/jsx-runtime"),le=({result:e})=>(0,t.jsx)(s.List.Item,{title:e.name,icon:{fileIcon:e.path},actions:(0,t.jsxs)(s.ActionPanel,{children:[(0,t.jsx)(s.Action.Open,{title:"Open in DEVONthink",target:`x-devonthink-item://${e.uuid}`}),(0,t.jsx)(s.Action.Open,{title:"Open in the default app",target:e.path}),(0,t.jsx)(s.Action.CopyToClipboard,{title:"Copy Item Link",content:`x-devonthink-item://${e.uuid}`}),(0,t.jsx)(s.Action.CopyToClipboard,{title:"Copy Markdown Link",content:`[${e.name}](x-devonthink-item://${e.uuid})`}),(0,t.jsx)(s.Action.Open,{title:"Reveal in DEVONthink",target:`x-devonthink-item://${e.uuid}?reveal=1`})]}),detail:(0,t.jsx)(s.List.Item.Detail,{metadata:(0,t.jsx)(s.List.Item.Detail.Metadata,{children:ce(e)})})}),J=le,f=(0,s.getPreferenceValues)(),ce=e=>{let a=[(0,t.jsx)(o,{propKey:"propertyName",title:"Name",text:e.name},"name"),(0,t.jsx)(j,{title:"Tags",children:e.tags.map(p=>(0,t.jsx)(ye,{text:p},p))},"tags"),(0,t.jsx)($,{propKey:"propertyUrl",title:"URL",text:H(e.url),target:e.url},"url"),(0,t.jsx)(o,{propKey:"propertyCreationDate",title:"Creation Date",text:D(e.creationDate)},"creationDate"),(0,t.jsx)(o,{propKey:"propertyModificationDate",title:"Modification Date",text:D(e.modificationDate)},"modificationDate"),(0,t.jsx)(o,{propKey:"propertyOpeningDate",title:"Opening Date",text:D(e.openingDate)},"openingDate"),(0,t.jsx)(o,{propKey:"propertyAdditionDate",title:"Addition Date",text:D(e.additionDate)},"additionDate"),(0,t.jsx)(o,{propKey:"propertyDate",title:"Date",text:D(e.date)},"date"),(0,t.jsx)(o,{propKey:"propertyLocation",title:"Location",text:e.location},"location"),(0,t.jsx)(o,{propKey:"propertySize",title:"Size",text:""+de(e.size,f.useSIUnits)},"size"),(0,t.jsx)(o,{propKey:"propertyScore",title:"Score",text:""+e.score},"score"),(0,t.jsx)(o,{propKey:"propertyType",title:"Type",text:e.type},"type"),(0,t.jsx)(o,{propKey:"propertyKind",title:"Kind",text:e.kind},"kind"),(0,t.jsx)($,{propKey:"propertyReferenceURL",title:"Reference URL",text:H(e.referenceURL),target:e.referenceURL},"referenceURL"),(0,t.jsx)(o,{propKey:"propertyPath",title:"Path",text:e.path},"path"),(0,t.jsx)(o,{propKey:"propertyFilename",title:"Filename",text:e.filename},"filename"),(0,t.jsx)(o,{propKey:"propertyLocationGroup",title:"Location Group",text:e.locationGroup},"locationGroup"),(0,t.jsx)(o,{propKey:"propertyMimeType",title:"MIME Type",text:e.mimeType},"mimeType"),(0,t.jsx)(o,{propKey:"propertyUnread",title:"Unread",text:e.unread?"yes":"no"},"unread"),(0,t.jsx)(o,{propKey:"propertyAliases",title:"Aliases",text:e.aliases},"aliases"),(0,t.jsx)(o,{propKey:"propertyComment",title:"Comment",text:e.comment},"comment"),(0,t.jsx)(o,{propKey:"propertyNumberOfHits",title:"Number of Hits",text:""+e.numberOfHits},"numberOfHits"),(0,t.jsx)(o,{propKey:"propertyAnnotationCount",title:"Annotation Count",text:""+e.annotationCount},"annotationCount"),(0,t.jsx)(o,{propKey:"propertyCharacterCount",title:"Character Count",text:""+e.characterCount},"characterCount"),(0,t.jsx)(o,{propKey:"propertyRating",title:"Rating",text:""+e.rating},"rating"),(0,t.jsx)(o,{propKey:"propertyPageCount",title:"Page Count",text:""+e.pageCount},"pageCount"),(0,t.jsx)(o,{propKey:"propertyWordCount",title:"Word Count",text:""+e.wordCount},"wordCount"),(0,t.jsx)(o,{propKey:"propertyAttachmentCount",title:"Attachment Count",text:""+e.attachmentCount},"attachmentCount"),(0,t.jsx)(o,{propKey:"propertyNumberOfDuplicates",title:"Number of Duplicates",text:""+e.numberOfDuplicates},"numberOfDuplicates"),(0,t.jsx)(o,{propKey:"propertyTagType",title:"Tag Type",text:e.tagType},"tagType"),(0,t.jsx)(o,{propKey:"propertyAttachedScript",title:"Attached Script",text:e.attachedScript},"attachedScript"),(0,t.jsx)(o,{propKey:"propertyClass",title:"Class",text:e.class},"class"),(0,t.jsx)(o,{propKey:"propertyHeight",title:"Height",text:""+e.height},"height"),(0,t.jsx)(o,{propKey:"propertyWidth",title:"Width",text:""+e.width},"width"),(0,t.jsx)(o,{propKey:"propertyDpi",title:"DPI",text:""+e.dpi},"dpi"),(0,t.jsx)(o,{propKey:"propertyAltitude",title:"Altitude",text:""+e.altitude},"altitude"),(0,t.jsx)(o,{propKey:"propertyLatitude",title:"Latitude",text:""+e.latitude},"latitude"),(0,t.jsx)(o,{propKey:"propertyLongitude",title:"Longitude",text:""+e.longitude},"longitude"),(0,t.jsx)(o,{propKey:"propertyID",title:"ID",text:""+e.id},"id"),(0,t.jsx)(o,{propKey:"propertyUUID",title:"UUID",text:e.uuid},"uuid"),(0,t.jsx)(o,{propKey:"propertyContentHash",title:"Content Hash",text:e.contentHash},"contentHash"),(0,t.jsx)(o,{propKey:"propertyInterval",title:"Interval",text:""+e.interval},"interval"),(0,t.jsx)(o,{propKey:"propertyNumberOfReplicants",title:"Number of Replicants",text:""+e.numberOfReplicants},"numberOfReplicants"),(0,t.jsx)(o,{propKey:"propertyBatesNumber",title:"Bates Number",text:""+e.batesNumber},"batesNumber"),(0,t.jsx)(o,{propKey:"propertyDuration",title:"Duration",text:""+e.duration},"duration"),(0,t.jsx)(o,{propKey:"propertyLabel",title:"Label",text:""+e.label},"label"),(0,t.jsx)(o,{propKey:"propertyState",title:"State",text:e.state?"yes":"no"},"state"),(0,t.jsx)(o,{propKey:"propertyExcludeFromTagging",title:"Exclude from Tagging",text:e.excludeFromTagging?"yes":"no"},"excludeFromTagging"),(0,t.jsx)(o,{propKey:"propertyStateVisibility",title:"State Visibility",text:e.stateVisibility?"yes":"no"},"stateVisibility"),(0,t.jsx)(o,{propKey:"propertyExcludeFromWikiLinking",title:"Exclude from Wiki Linking",text:e.excludeFromWikiLinking?"yes":"no"},"excludeFromWikiLinking"),(0,t.jsx)(o,{propKey:"propertyExcludeFromClassification",title:"Exclude from Classification",text:e.excludeFromClassification?"yes":"no"},"excludeFromClassification"),(0,t.jsx)(o,{propKey:"propertyLocking",title:"Locking",text:e.locking?"yes":"no"},"locking"),(0,t.jsx)(o,{propKey:"propertyIndexed",title:"Indexed",text:e.indexed?"yes":"no"},"indexed"),(0,t.jsx)(o,{propKey:"propertyExcludeFromSeeAlso",title:"Exclude from See Also",text:e.excludeFromSeeAlso?"yes":"no"},"excludeFromSeeAlso"),(0,t.jsx)(o,{propKey:"propertyExcludeFromSearch",title:"Exclude from Search",text:e.excludeFromSearch?"yes":"no"},"excludeFromSearch")].concat(ue({propKey:"propertyMetaData",record:e.metaData})),r=f.orderSearchResultItemProperties.split(",").map(p=>p.trim().toLowerCase()),i=[];r.forEach(p=>{let l=a.findIndex(g=>g.key?.toString().toLowerCase()===p);l<0||(i.push(a[l]),a[l]=(0,t.jsx)(t.Fragment,{}))});let n=a.filter(p=>p.key!==null);return i.concat(n)},W=s.List.Item.Detail.Metadata.Label,j=s.List.Item.Detail.Metadata.TagList,ye=j.Item,V=s.List.Item.Detail.Metadata.Link,o=({propKey:e,title:a,text:r})=>f[e]?f.hideEmptySearchResultItemProperties&&!r?null:(0,t.jsx)(W,{title:a,text:r}):null,$=({propKey:e,title:a,text:r,target:i})=>f[e]?f.hideEmptySearchResultItemProperties?i?(0,t.jsx)(V,{title:a,text:r,target:i}):null:i?(0,t.jsx)(V,{title:a,text:r,target:i}):(0,t.jsx)(o,{propKey:e,title:a,text:"No URL"}):null,ue=({propKey:e,record:a})=>f[e]?a===null?(0,t.jsx)(t.Fragment,{}):Object.entries(a).map(([r,i])=>{let n=typeof i=="string"?i:JSON.stringify(i);return(0,t.jsx)(W,{title:r,text:n},r)}):(0,t.jsx)(t.Fragment,{}),D=e=>{let a=new Date(e);return`${a.toLocaleDateString()} ${a.toLocaleTimeString()}`},de=(e,a=!1,r=1)=>{let i=a?1024:1e3;if(Math.abs(e)<i)return e+" B";let n=a?["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]:["kB","MB","GB","TB","PB","EB","ZB","YB"],p=-1,l=10**r;do e/=i,++p;while(Math.round(Math.abs(e)*l)/l>=i&&p<n.length-1);return e.toFixed(r)+" "+n[p]},H=e=>e.replace(/^[^:]+:\/\/([^/]+).*$/,"$1");var S=require("react"),m=require("@raycast/api"),me=()=>{let[e,a]=(0,S.useState)({appExistsLoading:!0,appExists:!1});return(0,S.useEffect)(()=>{(0,m.getApplications)().then(r=>r.find(i=>i.name==="DEVONthink 3")).then(r=>a({appExistsLoading:!1,appExists:r!==void 0}))},[]),(0,S.useEffect)(()=>{e.appExistsLoading||e.appExists||(0,m.showToast)({style:m.Toast.Style.Failure,title:"DEVONthink 3 is not installed",primaryAction:{title:"Download app",onAction:r=>(0,m.open)("https://www.devontechnologies.com/apps/devonthink").then(()=>r.hide())}})},[e.appExistsLoading,e.appExists]),e},G=me;var C=require("react"),z=P(w());var ge=({appExists:e})=>{let[a,r]=(0,C.useState)({databasesAreLoading:!0,databases:[]});return(0,C.useEffect)(()=>{if(!e){r(i=>({...i,databasesAreLoading:!1}));return}fe().then(i=>r(n=>({...n,databases:i}))).catch(I).finally(()=>r(i=>({...i,databasesAreLoading:!1})))},[e]),a},Y=ge,fe=async()=>await(0,z.jxa)({parse:!0})`
        const DT = Application("DEVONthink 3");

        const databases = DT.databases();

        return databases.map(db => ({
            uuid: db.uuid(),
            name: db.name()
        }))
    `;var u=require("react/jsx-runtime"),he=()=>{let e=G(),[a,r]=(0,O.useState)(""),[i,n]=(0,O.useState)(""),{isLoading:p,results:l}=U(e,a,i),{databasesAreLoading:g,databases:K}=Y(e),h=(0,y.getPreferenceValues)(),x=c=>(0,u.jsx)(J,{result:c},c.uuid),k=(0,u.jsx)(y.List.EmptyView,{title:"You need to have DEVONthink 3",icon:"devonthink-icon-small.png"});return(0,u.jsx)(y.List,{isLoading:e.appExistsLoading||p||g,searchBarPlaceholder:"Search DEVONthink Database...",onSearchTextChange:r,searchBarAccessory:(0,u.jsxs)(y.List.Dropdown,{tooltip:"Select database",onChange:n,storeValue:!0,children:[(0,u.jsx)(y.List.Dropdown.Item,{title:"All databases",value:""}),(0,u.jsx)(y.List.Dropdown.Section,{title:"Specific database",children:K.map(({name:c,uuid:b})=>(0,u.jsx)(y.List.Dropdown.Item,{title:c,value:b},b))})]}),isShowingDetail:h.searchIsShowingDetail&&l.length>0,throttle:!0,children:e.appExists?l.map(x):k})},xe=he;
